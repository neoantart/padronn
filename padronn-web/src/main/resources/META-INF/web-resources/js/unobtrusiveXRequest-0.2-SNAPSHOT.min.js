(function () {
    Application = function (a) {
        this.defaults = {
            defaultContent: "body",
            noAjaxClass: "noAjax",
            statusCode: {},
            onAfterSuccessRequest: function () {
            },
            onAfterFailRequest: function () {
            },
            onBeforeRequest: function () {
                $(this.defaultContent).fadeTo(1, 0.5)
            },
            onRequestComplete: function () {
                $(this.defaultContent).fadeTo("fast", 1)
            }
        };
        this.defaultContent = a.defaultContent ? a.defaultContent : this.defaults.defaultContent;
        this.noAjaxClass = a.noAjaxClass ? a.noAjaxClass : this.defaults.noAjaxClass;
        this.statusCode = a.statusCode ? a.statusCode : this.defaults.statusCode;
        this.onAfterSuccessRequest = a.onAfterSuccessRequest ? a.onAfterSuccessRequest : this.defaults.onAfterSuccessRequest;
        this.onAfterFailRequest = a.onAfterFailRequest ? a.onAfterFailRequest : this.defaults.onAfterFailRequest;
        this.onBeforeRequest = a.onBeforeRequest ? a.onBeforeRequest : this.defaults.onBeforeRequest;
        this.onRequestComplete = a.onRequestComplete ? a.onRequestComplete : this.defaults.onRequestComplete
    };
    Application.prototype.PeticionExitosa = function (a, b, d, e) {
        if (!this.afterRequest || eval(this.afterRequest +
                "()")) {
            var c;
            try {
                var f = $(a);
                if (1 == f.length) {
                    var g = f.first().attr("id");
                    document.getElementById(g) && (c = "#" + g)
                }
            } catch (h) {
            }
            c ? (this._target = c, $(this._target).html($(a).html())) : (this._target || (this._target = this.defaultContent), $(this._target).html(a));
            this.applicationObject.InicializarAcciones(this._target);
            this.afterInit && eval(this.afterInit + "()");
            this.applicationObject.onAfterSuccessRequest(a, b, d, e)
        }
    };
    Application.prototype.PeticionFallida = function (a, b, d) {
        this.applicationObject.onAfterFailRequest(a,
            b, d)
    };
    Application.prototype.BeforeRequest = function (a, b) {
        this.applicationObject.onBeforeRequest(a, b)
    };
    Application.prototype.RequestComplete = function () {
        this.applicationObject.onRequestComplete()
    };
    Application.prototype.InicializarAcciones = function (a) {
        a = a ? a + " " : "";
        $(a + "form:not(." + this.noAjaxClass + ")").submit({applicationObject: this}, function (b) {
            try {
                if (!$(this).attr("target") && (requestParams = b.data.applicationObject.getRequestComponents($(this).attr("action")), requestParams.requestUrl)) {
                    var a = b.data.applicationObject.getFunctionFromUrl(requestParams.requestUrl);
                    if (!a.beforeRequest || eval(a.beforeRequest + "()")) {
                        var e = requestParams.requestTarget || b.data.applicationObject.defaultContent;
                        $(this).ajaxSubmit({
                            applicationObject: b.data.applicationObject,
                            afterRequest: a.afterRequest,
                            afterInit: a.afterInit,
                            _target: e,
                            data: requestParams.requestParams,
                            success: b.data.applicationObject.PeticionExitosa,
                            error: b.data.applicationObject.PeticionFallida,
                            beforeSend: b.data.applicationObject.BeforeRequest,
                            complete: b.data.applicationObject.RequestComplete,
                            statusCode: b.data.applicationObject.statusCode,
                            cache: !1
                        })
                    }
                    b.preventDefault()
                }
            } catch (c) {
                b.preventDefault()
            }
        });
        $(a + "a[href]:not(." + this.noAjaxClass + ")").click({applicationObject: this}, function (b) {
            if (!$(this).attr("target") && (requestParams = b.data.applicationObject.getRequestComponents($(this).attr("href")), requestParams.requestUrl)) {
                var a = b.data.applicationObject.getFunctionFromUrl(requestParams.requestUrl);
                if (!a.beforeRequest || eval(a.beforeRequest + "()"))$.ajax({
                    applicationObject: b.data.applicationObject,
                    afterRequest: a.afterRequest,
                    afterInit: a.afterInit,
                    type: "get",
                    url: requestParams.requestUrl,
                    data: requestParams.requestParams,
                    _target: requestParams.requestTarget || b.data.applicationObject.defaultContent,
                    success: b.data.applicationObject.PeticionExitosa,
                    error: b.data.applicationObject.PeticionFallida,
                    beforeSend: b.data.applicationObject.BeforeRequest,
                    complete: b.data.applicationObject.RequestComplete,
                    statusCode: b.data.applicationObject.statusCode,
                    cache: !1
                });
                b.preventDefault()
            }
        });
        $(a + "input[type=text][href], " + a + "select[href]").change({applicationObject: this},
            function (b) {
                requestParams = b.data.applicationObject.getRequestComponents($(this).attr("href"));
                if (requestParams.requestUrl) {
                    var a = b.data.applicationObject.getFunctionFromUrl(requestParams.requestUrl);
                    if (!a.beforeRequest || eval(a.beforeRequest + "()")) {
                        var e = requestParams.requestTarget || b.data.applicationObject.defaultContent, c = $(this).attr("name");
                        ownParam = "";
                        "undefined" != c && "" != c && (ownParam = "&" + c + "=" + $(this).val());
                        $.ajax({
                            applicationObject: b.data.applicationObject,
                            afterRequest: a.afterRequest,
                            afterInit: a.afterInit,
                            type: "get",
                            url: requestParams.requestUrl,
                            data: requestParams.requestParams + ownParam,
                            _target: e,
                            success: b.data.applicationObject.PeticionExitosa,
                            error: b.data.applicationObject.PeticionFallida,
                            beforeSend: b.data.applicationObject.BeforeRequest,
                            complete: b.data.applicationObject.RequestComplete,
                            statusCode: b.data.applicationObject.statusCode,
                            cache: !1
                        })
                    }
                    b.preventDefault()
                }
            });
        $(a + "button[type=button][href], " + a + "input[type=button][href]").click({applicationObject: this}, function (b) {
            requestParams = b.data.applicationObject.getRequestComponents($(this).attr("href"));
            if (requestParams.requestUrl) {
                var a = b.data.applicationObject.getFunctionFromUrl(requestParams.requestUrl);
                if (!a.beforeRequest || eval(a.beforeRequest + "()")) {
                    var e = requestParams.requestTarget || b.data.applicationObject.defaultContent, c = $(this).attr("name");
                    ownParam = "";
                    "undefined" != c && "" != c && (ownParam = "&" + c + "=" + $(this).val());
                    $.ajax({
                        applicationObject: b.data.applicationObject,
                        afterRequest: a.afterRequest,
                        afterInit: a.afterInit,
                        type: "get",
                        url: requestParams.requestUrl,
                        data: requestParams.requestParams + ownParam,
                        _target: e,
                        success: b.data.applicationObject.PeticionExitosa,
                        error: b.data.applicationObject.PeticionFallida,
                        beforeSend: b.data.applicationObject.BeforeRequest,
                        complete: b.data.applicationObject.RequestComplete,
                        statusCode: b.data.applicationObject.statusCode,
                        cache: !1
                    })
                }
                b.preventDefault()
            }
        })
    };
    Application.prototype.getRequestComponents = function (a) {
        var b = {requestUrl: "", requestParams: "", requestTarget: ""};
        if (!a || "?" === a || "#" === a || "#?" === a || "?#" === a)return b;
        var d = document.createElement("a");
        d.href = a;
        var e = a.indexOf("?"),
            c = a.indexOf("#");
        firstSymbol = 0 <= e && 0 <= c ? e < c ? e : c : e > c ? e : c;
        b.requestUrl = 0 <= firstSymbol ? a.substr(0, firstSymbol) : a;
        if (0 == b.requestUrl.indexOf("javascript:") || 0 == b.requestUrl.indexOf("mailto:"))b.requestUrl = "";
        if (1 < d.search.length) {
            var a = d.search.substr(1).split("&"), f;
            for (f in a)tmpItem = a[f].split("="), tmpItem[0] && (finalValue = tmpItem[1] ? tmpItem[1] : $("#" + tmpItem[0]).val() || "", b.requestParams += tmpItem[0] + "=" + finalValue + "&");
            0 < b.requestParams.length && (b.requestParams = b.requestParams.substr(0, b.requestParams.length -
                1))
        }
        b.requestTarget = d.hash;
        return b
    };
    Application.prototype.getFunctionFromUrl = function (a) {
        try {
            var b = {}, d = a.replace(/[\-\.]/g, "_").replace(/[^0-9a-zA-Z_$\/]/g, "").replace(/(^[0-9]+)/, ""), d = d.replace(/(\/[0-9]*)/g, ".");
            b.beforeRequest = this.isFunction(d + ".beforeRequest");
            b.afterRequest = this.isFunction(d + ".afterRequest");
            b.afterInit = this.isFunction(d + ".afterInit");
            return b
        } catch (e) {
            return b
        }
    };
    Application.prototype.isFunction = function (a) {
        try {
            return "function" == eval("typeof " + a) ? a : !1
        } catch (b) {
            return !1
        }
    }
})();
